<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>QU·∫¢N L√ù UPS - KHOA XN & GPB</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #1e3a8a, #10b981); /* Blue to Green */
            --bg-body: #f1f5f9;
            --white: #ffffff;
            --text-dark: #1e293b;
        }

        * { box-sizing: border-box; font-family: "Times New Roman", Times, serif; }
        body { margin: 0; background: var(--bg-body); color: var(--text-dark); height: 100vh; display: flex; flex-direction: column; }

        /* Ti√™u ƒë·ªÅ ch√≠nh r·ª±c r·ª° */
        .header-banner {
            background: var(--primary-gradient);
            padding: 25px;
            text-align: center;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        .header-banner h1 { 
            margin: 0; font-size: 2.2rem; text-transform: uppercase; 
            letter-spacing: 3px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Thanh ƒëi·ªÅu h∆∞·ªõng Khoa */
        .dept-nav {
            display: flex; background: white; justify-content: center; gap: 5px; padding: 5px;
        }
        .dept-tab {
            padding: 12px 50px; cursor: pointer; font-weight: bold; font-size: 1.2rem;
            border-radius: 8px; transition: 0.4s; color: #64748b;
        }
        .dept-tab.active {
            background: var(--primary-gradient); color: white;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }

        .container { flex: 1; padding: 20px; max-width: 1500px; margin: auto; width: 100%; display: flex; flex-direction: column; }

        /* Toolbar nh·∫≠p li·ªáu n·ªïi kh·ªëi */
        .toolbar {
            background: white; padding: 18px; border-radius: 15px;
            display: flex; gap: 12px; align-items: center; margin-bottom: 20px;
            box-shadow: 5px 5px 15px #d1d9e6, -5px -5px 15px #ffffff;
        }
        input, select {
            padding: 10px 15px; border: 1px solid #e2e8f0; border-radius: 8px;
            outline: none; font-size: 1rem; background: #f8fafc; transition: 0.3s;
        }
        input:focus { border-color: #10b981; box-shadow: 0 0 8px rgba(16, 185, 129, 0.2); }

        .btn {
            padding: 10px 25px; border: none; border-radius: 8px;
            cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .btn-add { background: #10b981; color: white; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.4); }
        .btn-add:hover { background: #059669; transform: scale(1.05); }
        
        .btn-excel { background: #3b82f6; color: white; margin-left: auto; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4); }
        .btn-excel:hover { background: #2563eb; transform: scale(1.05); }

        /* B·∫£ng d·ªØ li·ªáu */
        .table-container {
            background: white; border-radius: 15px; flex: 1; overflow: hidden;
            box-shadow: 8px 8px 20px #d1d9e6, -8px -8px 20px #ffffff;
            display: flex; flex-direction: column;
        }
        .scroll-box { overflow-y: auto; flex: 1; padding: 10px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        thead th { 
            position: sticky; top: 0; background: #f1f5f9; padding: 15px; 
            text-align: left; color: #475569; z-index: 10; font-size: 1.1rem;
        }
        
        /* Hi·ªáu ·ª©ng Kh·ªëi di ƒë·ªông tr√™n d√≤ng */
        tbody tr { transition: all 0.3s ease; }
        tbody td { 
            background: white; padding: 15px; 
            border-top: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; 
            font-size: 1.15rem;
        }
        tbody td:first-child { border-left: 1px solid #f1f5f9; border-radius: 12px 0 0 12px; }
        tbody td:last-child { border-right: 1px solid #f1f5f9; border-radius: 0 12px 12px 0; }

        tbody tr:hover {
            transform: translateY(-4px) scale(1.01);
        }
        tbody tr:hover td {
            background: #ecfdf5; /* Xanh l√° c·ª±c nh·∫°t */
            border-color: #10b981;
            box-shadow: 0 6px 15px rgba(0,0,0,0.05);
            color: #047857;
        }

        /* Nh√£n T·∫ßng */
        .tag { padding: 4px 10px; border-radius: 6px; font-weight: bold; font-size: 0.85rem; color: white; }
        .tag-t1 { background: #3b82f6; } /* Blue */
        .tag-t3 { background: #10b981; } /* Green */
        
        .btn-del { color: #f87171; border: none; background: none; cursor: pointer; font-weight: bold; font-size: 1.2rem; }
        tr:hover .btn-del { color: #dc2626; }

        /* Tabs l·ªçc */
        .filter-area { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .f-tab { padding: 6px 20px; background: white; border-radius: 20px; border: 1.5px solid #cbd5e1; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .f-tab.active { background: #1e3a8a; color: white; border-color: #1e3a8a; }

    </style>
</head>
<body>

<div class="header-banner">
    <h1>TH·ªêNG K√ä H·ªÜ TH·ªêNG UPS</h1>
</div>

<div class="dept-nav">
    <div class="dept-tab active" onclick="switchDept('X√©t Nghi·ªám', this)">KHOA X√âT NGHI·ªÜM</div>
    <div class="dept-tab" onclick="switchDept('Gi·∫£i Ph·∫´u B·ªánh', this)">KHOA GI·∫¢I PH·∫™U B·ªÜNH</div>
</div>

<div class="container">
    <div class="filter-area">
        <div id="fAll" class="f-tab active" onclick="filter('all', this)">T·∫•t c·∫£ m√°y</div>
        <div id="fT1" class="f-tab" onclick="filter('T·∫ßng 1', this)">T·∫ßng 1</div>
        <div id="fT3" class="f-tab" onclick="filter('T·∫ßng 3', this)">T·∫ßng 3</div>
    </div>

    <div class="toolbar">
        <select id="floor">
            <option value="T·∫ßng 1">T·∫ßng 1</option>
            <option value="T·∫ßng 3">T·∫ßng 3</option>
        </select>
        <input type="text" id="dev" placeholder="T√™n m√°y x√©t nghi·ªám..." style="flex:2">
        <input type="text" id="model" placeholder="Model UPS..." style="flex:1">
        <input type="text" id="sn" placeholder="S·ªë Seri (S/N)..." style="flex:1">
        <button class="btn btn-add" onclick="pushData()">+ TH√äM M√ÅY</button>
        <button class="btn btn-excel" onclick="exportToExcel()">üìä XU·∫§T EXCEL</button>
    </div>

    <div class="table-container">
        <div class="scroll-box">
            <table id="upsTable">
                <thead>
                    <tr>
                        <th width="110px">V·ªã tr√≠</th>
                        <th>T√™n M√°y X√©t Nghi·ªám / Thi·∫øt B·ªã</th>
                        <th width="280px">Model UPS</th>
                        <th width="280px">S·ªë Serial (S/N)</th>
                        <th width="50px"></th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let currentDept = 'X√©t Nghi·ªám';
    const config = { databaseURL: "https://hautruong3339-c2db4-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(config);
    const db = firebase.database().ref("ups_system");

    function switchDept(dept, btn) {
        currentDept = dept;
        document.querySelectorAll('.dept-tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        
        const fT1 = document.getElementById('fT1');
        const floorSel = document.getElementById('floor');
        
        if(dept === 'Gi·∫£i Ph·∫´u B·ªánh') {
            fT1.style.display = 'none';
            floorSel.innerHTML = '<option value="T·∫ßng 3">T·∫ßng 3</option>';
            filter('T·∫ßng 3', document.getElementById('fT3'));
        } else {
            fT1.style.display = 'block';
            floorSel.innerHTML = '<option value="T·∫ßng 1">T·∫ßng 1</option><option value="T·∫ßng 3">T·∫ßng 3</option>';
            filter('all', document.getElementById('fAll'));
        }
        load();
    }

    function load() {
        db.child(currentDept).on('value', snap => {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = "";
            const data = snap.val();
            if(data) {
                Object.keys(data).forEach(id => {
                    const item = data[id];
                    const row = document.createElement('tr');
                    row.setAttribute('data-floor', item.floor);
                    row.innerHTML = `
                        <td><span class="tag ${item.floor === 'T·∫ßng 1' ? 'tag-t1' : 'tag-t3'}">${item.floor}</span></td>
                        <td contenteditable="true" onblur="update('${id}','dev',this.innerText)">${item.dev}</td>
                        <td contenteditable="true" onblur="update('${id}','model',this.innerText)">${item.model}</td>
                        <td contenteditable="true" onblur="update('${id}','sn',this.innerText)">${item.sn}</td>
                        <td><button class="btn-del" onclick="remove('${id}')">‚úï</button></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        });
    }

    function pushData() {
        const floor = document.getElementById('floor').value;
        const dev = document.getElementById('dev').value;
        const model = document.getElementById('model').value;
        const sn = document.getElementById('sn').value;
        if(!dev) return alert("Vui l√≤ng nh·∫≠p t√™n m√°y!");
        db.child(currentDept).push({ floor, dev, model, sn });
        document.getElementById('dev').value = ""; document.getElementById('model').value = ""; document.getElementById('sn').value = "";
    }

    function update(id, field, val) { db.child(currentDept).child(id).update({ [field]: val }); }
    function remove(id) { if(confirm("X√≥a m√°y n√†y?")) db.child(currentDept).child(id).remove(); }

    function filter(val, btn) {
        document.querySelectorAll('.f-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('#tbody tr').forEach(r => {
            r.style.display = (val === 'all' || r.getAttribute('data-floor') === val) ? '' : 'none';
        });
    }

    function exportToExcel() {
        const rows = Array.from(document.getElementById("upsTable").rows).filter(r => r.style.display !== 'none');
        const ws_data = rows.map(r => Array.from(r.cells).slice(0, 4).map(c => c.innerText));
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        XLSX.utils.book_append_sheet(wb, ws, "Th·ªëng k√™ UPS");
        XLSX.writeFile(wb, `UPS_${currentDept}.xlsx`);
    }

    load();
</script>
</body>
</html>